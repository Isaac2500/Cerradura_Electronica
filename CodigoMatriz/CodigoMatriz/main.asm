;
; CodigoMatriz.asm
;
; Created: 29/06/2021 03:14:32 p. m.
; Author : Isaac
;


; Replace with your application code
.org $00
.def REG1 = R16
.def REG2 = R17
.def REG3 = R18
.def REG4 = R19
.def REG5 = R20

jmp INICIO

RETRASO:	LDI REG2,$0F
RETRASO0:	LDI REG3,$37
RETRASO1:	LDI REG4,$C9
RETRASO2:	DEC REG4
			BRNE RETRASO2
			DEC REG3
			BRNE RETRASO1
			DEC REG2
			BRNE RETRASO0
			LDI REG2,$01
RETRASO3:	DEC REG2
			BRNE RETRASO3
			NOP
			RET


INICIO:
			LDI REG1,$8F
			OUT DDRD,REG1
			LDI REG1,$FF
			OUT DDRB,REG1
			LDI REG1,$00
			OUT PORTD,REG1
			OUT PORTB,REG1
			LDI REG1,$04
			OUT SPH,REG1
			LDI REG1,$5F
			OUT SPL,REG1

FILA1:
			CBI PORTD,0
			CBI PORTD,1
			CBI PORTD,2
			CBI PORTD,3
			SBI PORTD,0
			CALL RETRASO
			IN REG1,PIND
			CPI REG1,$01
			BREQ FILA2

F1_COLUMNA1:
			CPI REG1,$11
			BRNE F1_COLUMNA2
			LDI REG5,$11
			CBI PORTD,0
			JMP CIRCUITO

F1_COLUMNA2:
			CPI REG1,$21
			BRNE F1_COLUMNA3
			LDI REG5,$12
			JMP CIRCUITO

F1_COLUMNA3:
			CPI REG1,$41
			BRNE FILA2
			LDI REG5,$13
			JMP CIRCUITO

FILA2:
			CBI PORTD,0
			CBI PORTD,1
			CBI PORTD,2
			CBI PORTD,3
			SBI PORTD,1
			CALL RETRASO
			IN REG1,PIND
			CPI REG1,$20
			BREQ FILA3

F2_COLUMNA1:
			CPI REG1,$12
			BRNE F2_COLUMNA2
			LDI REG5,$14
			JMP CIRCUITO

F2_COLUMNA2:
			CPI REG1,$22
			BRNE F2_COLUMNA3
			LDI REG5,$15
			JMP CIRCUITO

F2_COLUMNA3:
			CPI REG1,$42
			BRNE FILA3
			LDI REG5,$16
			JMP CIRCUITO

FILA3:
			CBI PORTD,0
			CBI PORTD,1
			CBI PORTD,2
			CBI PORTD,3
			SBI PORTD,2
			CALL RETRASO
			IN REG1,PIND
			CPI REG1,$04
			BREQ FILA4

F3_COLUMNA1:
			CPI REG1,$14
			BRNE F3_COLUMNA2
			LDI REG5,$17
			JMP CIRCUITO

F3_COLUMNA2:
			CPI REG1,$24
			BRNE F3_COLUMNA3
			LDI REG5,$18
			JMP CIRCUITO

F3_COLUMNA3:
			CPI REG1,$44
			BRNE FILA4
			LDI REG5,$19
			JMP CIRCUITO
			
FILA4:
			CBI PORTD,0
			CBI PORTD,1
			CBI PORTD,2
			CBI PORTD,3
			SBI PORTD,3
			CALL RETRASO
			IN REG1,PIND
			CPI REG1,$08
			BREQ CIRCUITO

F4_COLUMNA1:
			CPI REG1,$18
			BRNE F4_COLUMNA2
			LDI REG5,$1A
			JMP CIRCUITO

F4_COLUMNA2:
			CPI REG1,$28
			BRNE F4_COLUMNA3
			LDI REG5,$10
			JMP CIRCUITO

F4_COLUMNA3:
			CPI REG1,$48
			BRNE CIRCUITO
			LDI REG5,$1C
			JMP CIRCUITO
CIRCUITO:
			CBI PORTD,0
			CBI PORTD,1
			CBI PORTD,2
			CBI PORTD,3
			OUT PORTB,REG5
			CALL RETRASO
			LDI REG5,$00
			OUT PORTB,REG5
			JMP FILA1

